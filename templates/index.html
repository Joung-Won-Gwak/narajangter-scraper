{% extends "base.html" %}

{% block title %}ëŒ€ì‹œë³´ë“œ - ë‚˜ë¼ì¥í„° ì…ì°°ê³µê³ {% endblock %}

{% block content %}
<header class="header">
    <h1>ğŸ“Š ëŒ€ì‹œë³´ë“œ</h1>
    <p class="subtitle">ì •ë³´ì‹œìŠ¤í…œ ê°ë¦¬ ê³µê³  í˜„í™©</p>
</header>

<div class="stats-section">
    <div class="stat-card">
        <div class="stat-number" id="totalCount">-</div>
        <div class="stat-label">ì „ì²´ ê³µê³ </div>
    </div>
    <div class="stat-card">
        <div class="stat-number" id="todayCount">-</div>
        <div class="stat-label">ìµœê·¼ ìˆ˜ì§‘</div>
    </div>
</div>

<div class="quick-actions">
    <a href="/collect" class="action-card">
        <div class="action-icon">ğŸ“¥</div>
        <h3>ë°ì´í„° ìˆ˜ì§‘</h3>
        <p>ê³µê³µë°ì´í„°í¬í„¸ì—ì„œ ì…ì°°ê³µê³  ìˆ˜ì§‘</p>
    </a>
    <a href="/search" class="action-card">
        <div class="action-icon">ğŸ”</div>
        <h3>ë°ì´í„° ì¡°íšŒ</h3>
        <p>ìˆ˜ì§‘ëœ ê³µê³  ê²€ìƒ‰ ë° í•„í„°ë§</p>
    </a>
    <a href="/proposal" class="action-card">
        <div class="action-icon">ğŸ“</div>
        <h3>ì œì•ˆì„œ ìƒì„±</h3>
        <p>AI ê¸°ë°˜ ì œì•ˆì„œ ìë™ ìƒì„±</p>
    </a>
</div>

<div class="table-container">
    <h2 class="section-title">ìµœê·¼ ê³µê³ </h2>
    <table class="notices-table">
        <thead>
            <tr>
                <th>ê³µê³ ë²ˆí˜¸</th>
                <th>ê³µê³ ëª…</th>
                <th>ë°œì£¼ê¸°ê´€</th>
                <th>ì¶”ì •ê°€ê²©</th>
                <th>ê³µê³ ì¼</th>
                <th>ìƒì„¸</th>
            </tr>
        </thead>
        <tbody id="noticesBody">
            <tr>
                <td colspan="6" class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td>
            </tr>
        </tbody>
    </table>
</div>
{% endblock %}

{% block extra_js %}
<script>
    async function loadNotices() {
        try {
            const response = await fetch('/api/notices?limit=10');
            const result = await response.json();

            if (result.success) {
                document.getElementById('totalCount').textContent = result.count;
                document.getElementById('todayCount').textContent = result.count;
                renderNotices(result.data);
            } else {
                showError(result.error);
            }
        } catch (error) {
            showError(error.message);
        }
    }

    function renderNotices(notices) {
        const tbody = document.getElementById('noticesBody');

        if (notices.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="no-data">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            return;
        }

        tbody.innerHTML = notices.map(n => `
            <tr>
                <td class="notice-id">${n.notice_id || '-'}</td>
                <td class="notice-title">${n.title || '-'}</td>
                <td class="notice-org">${n.organization || '-'}</td>
                <td class="notice-price">${n.estimated_price_formatted}</td>
                <td class="notice-date">${formatDate(n.publish_date)}</td>
                <td class="notice-link">
                    ${n.notice_url ? `<a href="${n.notice_url}" target="_blank" class="detail-link">ìƒì„¸ë³´ê¸°</a>` : '-'}
                </td>
            </tr>
        `).join('');
    }

    function formatDate(dateStr) {
        if (!dateStr) return '-';
        return dateStr.split(' ')[0];
    }

    function showError(message) {
        const tbody = document.getElementById('noticesBody');
        tbody.innerHTML = `<tr><td colspan="6" class="error">ì˜¤ë¥˜: ${message}</td></tr>`;
    }

    document.addEventListener('DOMContentLoaded', loadNotices);
</script>
{% endblock %}